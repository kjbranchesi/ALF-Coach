<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALF Project Builder - Sample Project Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .stage {
            background: #f8fafc;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        .stage.active {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        .stage.completed {
            border-left-color: #10b981;
            background: #ecfdf5;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px 8px 8px 0;
            transition: background 0.2s;
        }
        button:hover {
            background: #4338ca;
        }
        button.secondary {
            background: #6b7280;
        }
        .results {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-family: monospace;
            font-size: 14px;
        }
        .warning {
            background: #fefce8;
            border: 1px solid #eab308;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .data-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ ALF Project Builder - Complete Flow Test</h1>
    <p><strong>Testing:</strong> Environmental Science sustainability project (like hero-sustainability)</p>

    <div class="test-container">
        <h2>üìã Test Plan: Creating a Hero Project</h2>

        <div class="stage active" id="stage1">
            <h3>Stage 1: Wizard Setup</h3>
            <p><strong>Goal:</strong> Create project foundation through wizard</p>
            <ul>
                <li>Subject: Environmental Science</li>
                <li>Grade: High School</li>
                <li>Duration: 6-8 weeks</li>
                <li>Topic: Campus Sustainability Research</li>
            </ul>
            <button onclick="startWizard()">Start Wizard</button>
            <button onclick="simulateWizardData()" class="secondary">Simulate Wizard Data</button>
        </div>

        <div class="stage" id="stage2">
            <h3>Stage 2: Chat Conversation</h3>
            <p><strong>Goal:</strong> AI coaching through all conversation stages</p>
            <ul>
                <li>Big Idea development</li>
                <li>Essential Question refinement</li>
                <li>Challenge definition</li>
                <li>Journey planning</li>
                <li>Deliverables creation</li>
            </ul>
            <button onclick="startChat()" disabled id="chatButton">Start Chat Conversation</button>
        </div>

        <div class="stage" id="stage3">
            <h3>Stage 3: Data Verification</h3>
            <p><strong>Goal:</strong> Verify data persistence and quality</p>
            <ul>
                <li>Check localStorage storage</li>
                <li>Verify auto-save functionality</li>
                <li>Confirm Hero Project transformation</li>
            </ul>
            <button onclick="checkDataPersistence()" disabled id="dataButton">Check Data</button>
        </div>

        <div class="stage" id="stage4">
            <h3>Stage 4: Output Analysis</h3>
            <p><strong>Goal:</strong> Compare to Hero Project standard (400-500 lines)</p>
            <ul>
                <li>Analyze generated project structure</li>
                <li>Count lines and complexity</li>
                <li>Compare to hero-sustainability.ts</li>
            </ul>
            <button onclick="analyzeOutput()" disabled id="analysisButton">Analyze Output</button>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Test Results</h2>
        <div id="testResults"></div>
    </div>

    <script>
        let currentStage = 1;
        let projectId = null;
        let testResults = document.getElementById('testResults');

        function logResult(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'results';
            div.innerHTML = `<strong>${timestamp}</strong>: ${message}`;
            testResults.appendChild(div);
            testResults.scrollTop = testResults.scrollHeight;
        }

        function updateStage(stageNum) {
            // Update visual stages
            for (let i = 1; i <= 4; i++) {
                const stage = document.getElementById(`stage${i}`);
                if (i < stageNum) {
                    stage.className = 'stage completed';
                } else if (i === stageNum) {
                    stage.className = 'stage active';
                } else {
                    stage.className = 'stage';
                }
            }

            // Enable next button
            if (stageNum === 2) document.getElementById('chatButton').disabled = false;
            if (stageNum === 3) document.getElementById('dataButton').disabled = false;
            if (stageNum === 4) document.getElementById('analysisButton').disabled = false;
        }

        function startWizard() {
            logResult('üöÄ Starting wizard for Environmental Science sustainability project...');

            // Open wizard in new tab
            window.open('http://localhost:5173/app/blueprint/new-project', '_blank');

            logResult('‚úÖ Wizard opened. Please complete these steps:', 'info');
            logResult('1. Select "Environmental Science" as subject', 'info');
            logResult('2. Choose "High School" grade level', 'info');
            logResult('3. Set duration to "6-8 weeks"', 'info');
            logResult('4. Enter topic: "Campus Sustainability Research and Policy Change"', 'info');
            logResult('5. Click through to reach the chat interface', 'info');

            setTimeout(() => {
                updateStage(2);
                logResult('‚ö†Ô∏è Manual step: Click "Start Chat Conversation" after completing wizard', 'warning');
            }, 5000);
        }

        function simulateWizardData() {
            logResult('üîÑ Simulating wizard data for testing...');

            // Create mock project data
            const mockProject = {
                id: 'test-sustainability-' + Date.now(),
                wizardData: {
                    subjects: ['Environmental Science'],
                    gradeLevel: 'High School',
                    duration: '6-8 weeks',
                    projectTopic: 'Campus Sustainability Research and Policy Change',
                    materials: 'Digital scales, water testing kits, survey platforms',
                    location: 'school campus, community sites'
                },
                stage: 'BIG_IDEA',
                createdAt: new Date().toISOString()
            };

            projectId = mockProject.id;
            localStorage.setItem(`blueprint_${projectId}`, JSON.stringify(mockProject));

            logResult(`‚úÖ Mock project created: ${projectId}`, 'info');
            updateStage(2);
        }

        function startChat() {
            if (!projectId) {
                // Try to find existing project
                const blueprintKeys = Object.keys(localStorage).filter(k => k.startsWith('blueprint_'));
                if (blueprintKeys.length > 0) {
                    const key = blueprintKeys[blueprintKeys.length - 1]; // Get latest
                    projectId = key.replace('blueprint_', '');
                    logResult(`üìç Found existing project: ${projectId}`, 'info');
                } else {
                    logResult('‚ùå No project found. Please complete wizard first.', 'error');
                    return;
                }
            }

            logResult(`üîÑ Opening chat interface for project: ${projectId}`);

            // Open chat interface
            window.open(`http://localhost:5173/app/blueprint/${projectId}`, '_blank');

            logResult('‚úÖ Chat interface opened. Complete this conversation flow:', 'info');
            logResult('1. Develop BIG IDEA: Complex environmental challenges require evidence-based solutions', 'info');
            logResult('2. Essential Question: How can we use data and advocacy to create lasting change?', 'info');
            logResult('3. Challenge: Conduct research and implement community-driven solutions', 'info');
            logResult('4. Journey: Define phases for data collection, analysis, solution design, implementation', 'info');
            logResult('5. Reach COMPLETE stage to trigger Hero Project transformation', 'info');

            setTimeout(() => {
                updateStage(3);
                logResult('‚ö†Ô∏è Click "Check Data" after completing conversation', 'warning');
            }, 10000);
        }

        function checkDataPersistence() {
            logResult('üîç Checking data persistence and auto-save...');

            // Check localStorage for ALF project data
            const alfKeys = Object.keys(localStorage).filter(key =>
                key.startsWith('alf_project_') ||
                key.startsWith('alf_hero_') ||
                key.startsWith('blueprint_')
            );

            logResult(`üìä Found ${alfKeys.length} storage keys: ${alfKeys.slice(0, 5).join(', ')}${alfKeys.length > 5 ? '...' : ''}`, 'info');

            // Check for UnifiedStorageManager data
            const unifiedKeys = alfKeys.filter(k => k.startsWith('alf_project_'));
            const heroKeys = alfKeys.filter(k => k.startsWith('alf_hero_'));

            logResult(`üéØ UnifiedStorageManager keys: ${unifiedKeys.length}`, 'info');
            logResult(`ü¶∏ Hero transformation keys: ${heroKeys.length}`, 'info');

            // Analyze most recent project data
            if (unifiedKeys.length > 0 || heroKeys.length > 0) {
                const latestKey = [...unifiedKeys, ...heroKeys].sort().pop();
                try {
                    const data = JSON.parse(localStorage.getItem(latestKey));
                    const dataSize = JSON.stringify(data).length;
                    const lineCount = JSON.stringify(data, null, 2).split('\n').length;

                    logResult(`üìè Latest project data: ${dataSize} characters, ~${lineCount} lines`, 'info');
                    logResult(`üìã Structure: ${Object.keys(data).join(', ')}`, 'info');

                    if (data.capturedData) {
                        logResult(`üí¨ Chat data captured: ${Object.keys(data.capturedData).join(', ')}`, 'info');
                    }

                    updateStage(4);
                } catch (e) {
                    logResult(`‚ùå Error parsing project data: ${e.message}`, 'error');
                }
            } else {
                logResult('‚ùå No ALF project data found. Complete chat conversation first.', 'error');
            }
        }

        function analyzeOutput() {
            logResult('üî¨ Analyzing output quality vs Hero Project standard...');

            // Find hero project data
            const heroKeys = Object.keys(localStorage).filter(k => k.startsWith('alf_hero_'));

            if (heroKeys.length === 0) {
                logResult('‚ùå No hero project transformation found', 'error');
                logResult('üí° This suggests the HeroProjectTransformer may not have run', 'warning');
                return;
            }

            const latestHeroKey = heroKeys.sort().pop();
            try {
                const heroData = JSON.parse(localStorage.getItem(latestHeroKey));
                const heroJson = JSON.stringify(heroData, null, 2);
                const heroLines = heroJson.split('\n').length;
                const heroSize = heroJson.length;

                logResult(`üìä GENERATED HERO PROJECT ANALYSIS:`, 'info');
                logResult(`Lines: ${heroLines} (target: 400-500)`, heroLines >= 400 ? 'info' : 'warning');
                logResult(`Size: ${heroSize} characters`, 'info');

                // Check for key Hero Project components
                const hasPhases = heroData.journey?.phases?.length > 0;
                const hasAssessments = heroData.deliverables || heroData.checkpoints;
                const hasScaffolding = heroData.scaffolding || heroData.differentiation;
                const hasStandards = heroData.alignment;

                logResult(`‚úÖ Key Components Check:`, 'info');
                logResult(`Phases: ${hasPhases ? '‚úÖ' : '‚ùå'}`, hasPhases ? 'info' : 'warning');
                logResult(`Assessments: ${hasAssessments ? '‚úÖ' : '‚ùå'}`, hasAssessments ? 'info' : 'warning');
                logResult(`Scaffolding: ${hasScaffolding ? '‚úÖ' : '‚ùå'}`, hasScaffolding ? 'info' : 'warning');
                logResult(`Standards: ${hasStandards ? '‚úÖ' : '‚ùå'}`, hasStandards ? 'info' : 'warning');

                // Show sample of the data
                const preview = heroJson.substring(0, 1000) + (heroJson.length > 1000 ? '\n...[truncated]' : '');

                const dataDiv = document.createElement('div');
                dataDiv.innerHTML = `
                    <h3>üéØ Generated Hero Project Data (first 1000 chars):</h3>
                    <div class="data-output">${preview}</div>
                `;
                testResults.appendChild(dataDiv);

                // Final assessment
                const quality = heroLines >= 400 && hasPhases && hasAssessments ? 'HIGH' :
                              heroLines >= 200 && hasPhases ? 'MEDIUM' : 'LOW';

                logResult(`üèÜ FINAL ASSESSMENT: ${quality} QUALITY`, quality === 'HIGH' ? 'info' : 'warning');

                if (quality === 'HIGH') {
                    logResult('üéâ SUCCESS: ALF Project Builder produced Hero Project quality output!', 'info');
                } else {
                    logResult('‚ö†Ô∏è NEEDS IMPROVEMENT: Output below Hero Project standard', 'warning');
                    logResult('üí° Consider enhancing HeroProjectTransformer to add more scaffolding', 'info');
                }

            } catch (e) {
                logResult(`‚ùå Error analyzing hero data: ${e.message}`, 'error');
            }
        }

        // Auto-check for existing data on load
        setTimeout(() => {
            const existingKeys = Object.keys(localStorage).filter(k =>
                k.startsWith('alf_') || k.startsWith('blueprint_')
            );
            if (existingKeys.length > 0) {
                logResult(`üîç Found ${existingKeys.length} existing project(s) in storage`, 'info');
            }
        }, 1000);
    </script>
</body>
</html>